<main id="skip-header-target" role="main">
  <section class="py-3 d-flex justify-content-center">
    <div class="container-fluid mx-3">
      <div class="row matrix-gutter justify-content-center">
        <div class="col-8">
          <!-- Top headings -->
          <div class="col pb-2"><%= render partial: 'accessions/idbadge', locals: {:result => @result, :props => { :full => true} } %></div>
          <!-- Page actions probably not needed for accessions -->
          <div class="col pb-1 hidden"><%= render partial: 'shared/page_actions', locals: {:record => @result, :title => @result.display_string, :url => request.fullpath } %></div>

          <!-- Classifications (Records Groups) -->
          <% unless @result.classifications.blank? %>
            <% @result.classifications.each do |classification| %>
              <div class="col pb-2">
                <a href="<%= classification['uri'] %>"><%= classification['title'] %></a>
              </div>
            <% end %>
          <% end %>
        </div>

        <div class="col-3">
          <!-- Placeholder column to align margins -->
        </div>

        <div class="col-8">
          <hr>

          <div class="col pt-1 pb-1">
            <h2><%= t('accession._public.section.description') %></h2>
            <p><%= @result.content_description %></p>
          </div>

          <%= render partial: 'accessions/record_innards' %>

          <hr>

          <div class="col pt-2 pb-2">
            <h2>Access to Unprocessed Archival Collections</h2>
            <p id="unprocessed-note">
              Access to Unprocessed Archival Collections
              Unprocessed collections may include protected information related to personal privacy, health information,
              and minors, as well as attorney-client privilege. In accordance with laws and regulations, this material
              will be reviewed prior to providing public access and certain records may be subject to redaction or other
              measures that restrict access. Archival and library collections may also be restricted based on physical
              condition.</p>
          </div>
        </div>

        <!-- Process linked records -->
        <% classifications = Array.new  %>
        <% @result.classifications.each do |classification| %>
          <% classifications.push(classification['uri']) %>
        <% end unless @result['json']['classifications'].blank? %>

        <% unless classifications.blank? %>
          <script>
              $.ajax({
                  url: '<%= @result.classifications[0]['uri'] %>/linked_records',
                  type: 'GET',
                  data: { classifications: <%= classifications.to_json.html_safe %>,
                      original_accession: <%= @result['uri'].to_json.html_safe %> },
                  dataType: 'json',
                  success: function (data) {
                      console.log(data);
                      let accessions = data['accessions'];
                      let resources = data['resources'];
                      if (accessions.length !== 0) {
                          $('#related-accessions').removeClass('hidden');
                          for (let i = 0; i < accessions.length; i++){
                              let uri = accessions[i]['uri'];
                              let title = accessions[i]['title'];
                              $('#related-accessions-list').append('<li class="pb-2"><a href="' + uri + '">' + title + '</a><li>');
                          }
                      }
                      if (resources.length !== 0) {
                          $('#related-collections').removeClass('hidden');
                          for (let i = 0; i < resources.length; i++){
                              let uri = resources[i]['uri'];
                              let title = resources[i]['title'];
                              $('#related-collections-list').append('<li class="pb-2"><a href="' + uri + '">' + title + '</a><li>');
                          }
                      }
                  }
              });
          </script>
        <% end %>

        <!-- Side bar -->
        <div id="accessions-sidebar" class="col-3">
          <div id="related-accessions" class="hidden pb-2">
            <div class="col pt-1">
              <h2>Related Accessions</h2>
              <ul id="related-accessions-list" class="unstyled-list"></ul>
            </div>
          </div>
          <div id="related-collections" class="hidden">
            <div class="col pt-1">
              <h2>Related Collections</h2>
              <ul id="related-collections-list" class="unstyled-list"></ul>
            </div>
          </div>
        </div>
      </div>
      <%= render partial: 'shared/modal_actions' %>
    </div>
    <!-- .container -->
  </section>
</main>